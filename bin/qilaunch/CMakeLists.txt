# Copyright (C) 2015 Aldebaran Robotics
cmake_minimum_required(VERSION 2.8)
project(QiLaunch)

find_package(qibuild)
find_package(qimodule)

if(DEFINED ENV{BUILD_TAG})
  set(_build_tag $ENV{BUILD_TAG})
else()
  set(_build_tag "dev-build")
endif()

set_source_files_properties(qilaunch.cpp
    PROPERTIES
      COMPILE_DEFINITIONS BUILD_TAG=\"-${_build_tag}\"
)

qi_create_bin(qilaunch
  qilaunch.cpp
  DEPENDS QI QICORE BOOST_PROGRAM_OPTIONS QT5_CORE BREAKPAD
  )

qi_create_module(qilaunchtestmodule SRC qilaunchtestmodule.cpp DEPENDS QI NO_INSTALL)

qi_add_test(qilaunch_func qilaunch ARGUMENTS --qi-standalone -n testlauncher -f qilaunchtestmodule.func)
qi_add_test(qilaunch_func_session qilaunch ARGUMENTS --qi-standalone -n testlauncher -f qilaunchtestmodule.funcWithSession)

qi_add_test(
  qilaunch_func_args

  qilaunch
  ARGUMENTS
  --qi-log-level 6
  --qi-standalone
  -n testlauncher
  -f "qilaunchtestmodule.funcWithArgs(3.14159, \"un string\", {\"peripateticien\": \"aristote\", \"dodecahedre\": 42})"
)

qi_add_test(
  qilaunch_func_session_args

  qilaunch
  ARGUMENTS
  --qi-log-level 6
  --qi-standalone
  -n testlauncher
  -f "qilaunchtestmodule.funcWithSessionAndArgs(3.14159, \"un string\", {\"peripateticien\": \"aristote\", \"dodecahedre\": 42})"
)

qi_add_test(qilaunch_service qilaunch ARGUMENTS --qi-standalone -n testlauncher -o qilaunchtestmodule.MyService -f qilaunchtestmodule.testMyService)
